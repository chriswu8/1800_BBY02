<!DOCTYPE html>
<html>

<head>

    <style>
        body {
            background: linear-gradient(#0f2027, #203a43, #2c5364);
            width: 100%;
            height: auto;
            color: white;
            overflow-y: hidden;
        }

        h1 {
            text-align: center;
            color: #FFFFFF;
            text-shadow: 0px 0px 7px;
            font-size: 2vw;
            text-shadow: 0 0 4px #FFF, 0 0 10px #FFF, 0 0 15px #FFF, 0 0 20px #18f0ff, 0 0 30px #53ece0, 0 0 40px #9aff7e, 0 0 55px #49FF18, 0 0 75px #49ff18;
        }

        form {
            width: 80%;
            margin: 100px;
        }

        input {
            margin: 0px;
        }

        footer {
            background-color: #BBB;
            height: 8vh;
        }
    </style>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="comp1800 template" content="Post">

    <!-- Optional styles and scripts of your own -->
    <link type="text/css" href="styles/my_style.css">

    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI_TEAMBBY02.js"></script>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Navbar
    <nav class="navbar navbar-expand-lg navbar-light bg-warning">
        <div class="container-fluid">
            <a class="navbar-brand">Chris's Hiking App - Reviews</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="login.html">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Navigate</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Saved</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="profile.html">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav> -->



    <br> <br><br> <br>

    <h1>Add New Post <span id="PT"></span></h1>




    <form>
        <fieldset class="mb-3" id="personalInfoFields">
            <div class="form-group">
                <label style="color: white">Title</label>
                <input type="text" id="titleInput" class="form-control">
            </div>
            <br>

            <div class="form-group">
                <label style="color: white">Location</label>
                <input type="text" id="locationInput" class="form-control" >
            </div>
            <br>

            <div class="form-group">
                <label style="color: white">Description</label>
                <textarea type="text" class="form-control" id="descriptionInput" rows="3"> </textarea>
            </div><br>
        </fieldset>


        <br>
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-lg btn-primary pull-right" onclick="saveUserInfo()">Save </button>
            &nbsp; &nbsp;
            <button type="button" class="btn btn-lg btn-primary pull-right" onclick="writePost()">Next </button>
        </div>
    </form>



    <footer class="navbar justify-content-evenly fixed-bottom">
        <i class="material-icons">home</i>
        <i class="material-icons">info</i>
        <i class="material-icons"><span class="material-icons-two-tone">
                volunteer_activism
            </span></i>
        <i class="material-icons">settings</i>
    </footer>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->

    <script>

        let postID = localStorage.getItem("postID");


        db.collection("Posts").where("code", "==", postID)
            .get()
            .then(queryPost => {
                //see how many results you have got from the query
                size = queryPost.size;
                // get the documents of query
                Posts = queryPost.docs;

                // We want to have one document per post, so if the the result of 
                //the query is more than one, we can check it right now and clean the DB if needed.
                if (size = 1) {
                    var thisPost = Posts[0].data();
                    title = thisPost.title;
                    document.getElementById("PT").innerHTML = title;
                } else {
                    console.log("Query has more than one data")
                }
            })
            .catch((error) => {
                console.log("Error getting documents: ", error);
            });



        function writePost() {

            let Title = document.getElementById("titleInput").value;
            let Description = document.getElementById("descriptionInput").value;
            let Location = document.getElementById("locationInput").value;

            firebase.auth().onAuthStateChanged(user => {   // find out  who's currently logged
                if (user) {
                    var currentUser = db.collection("users").doc(user.uid)
                    var userID = user.uid;
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            //get user Email
                            var userEmail = userDoc.data().email;
                            // Start a new collection and add all data in it.
                            db.collection("posts").add({
                                Code: postID,
                                UserID: userID,
                                // UserEmail: userEmail,
                                Title: Title,
                                Description: Description,
                                Location: Location
                            });
                        })
                } else {
                    // No user is signed in.
                    console.log("no user signed in");
                }
            });
        }



        function editUserInfo() {
            //Enable the form fields
            document.getElementById('personalInfoFields').disabled = false;
        }




        function saveUserInfo() {
            userTitle = document.getElementById('titleInput').value;       // get the value of the field with id="nameInput"
            userLocation = document.getElementById('locationInput').value;   // get the value of the field with id="schoolInput"
            userDescription = document.getElementById('descriptionInput').value;       // get the value of the field with id="cityInput"

            currentUser.update({
                title: userTitle,
                location: userLocation,
                description: userDescription
            })
                .then(() => {
                    console.log("Document successfully updated!");
                })


            // Make the form disabled after the "Save" button is clicked
            document.getElementById('personalInfoFields').disabled = true;
        }

    </script>

</body>

</html>