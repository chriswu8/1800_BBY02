<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Availabilities</title>

    <meta name="comp1800 BBY-02" content="Availabilities page">
    <meta name="author" content="BBY02">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">



    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI_TEAMBBY02.js"></script>

    <style>
        html {
            padding: 0px;
            margin: 0px;
            background-color: rgb(6, 78, 66);
            background-image: linear-gradient(#0F2027, #203A43, #2C5364);
            height: 110%;
        }


        body {
            background-color: rgb(6, 78, 66);
            background-image: linear-gradient(#0F2027, #203A43, #2C5364);
        }


        .pset {
            font-size: 20px;
            text-align: center;
        }

        footer {
            background-color: #BBB;
            height: 8vh;
        }

        .headerset {
            display: grid;
            text-align: center;
            top: 10%;
            color: aliceblue;
        }

        table td {
            width: 600px;
            height: 20px;
            text-align: center;
            vertical-align: middle;
            background-color: #ccc;
            border: 1px solid #fff;
            font-size: 10px;

        }

        table td.highlighted {
            background-color: rgb(235, 238, 73);
        }

        .tableTime {
            width: 600px;
            height: 20px;
            text-align: center;
            vertical-align: middle;
            background-color: rgb(112, 112, 112);
            border: 1px solid #fff;
            color: aliceblue;

        }
    </style>
</head>

<body>

    <!------------------------------------>
    <!----------HTML layout goes here----->
    <!------------------------------------>

    <div class="container">

        <br>

        <header class="headerset">
            <h1>Availability</h1>
            <hr style="width: 90%;">
        </header>

        <br>


        <table cellpadding="20" cellspacing="0" id="our_table">
            <tr class="tableTime">
                <td class="tableTime"></td>
                <td class="tableTime">Monday</td>
                <td class="tableTime">Tuesday</td>
                <td class="tableTime">Wednesday</td>
                <td class="tableTime">Thursday</td>
                <td class="tableTime">Friday</td>
                <td class="tableTime">Saturday</td>
                <td class="tableTime">Sunday</td>
            </tr>
            <tr>
                <td class="tableTime">8:00-9:00AM</td>
                <td id="M800"></td>
                <td id="T800"></td>
                <td id="W800"></td>
                <td id="Th800"></td>
                <td id="F800"></td>
                <td id="S800"></td>
                <td id="Su800"></td>
            </tr>
            <tr>
                <td class="tableTime">9:00-10:00AM</td>
                <td id="M900"></td>
                <td id="T900"></td>
                <td id="W900"></td>
                <td id="Th900"></td>
                <td id="F900"></td>
                <td id="S900"></td>
                <td id="Su900"></td>
            </tr>

            <tr>
                <td class="tableTime">10:00-11:00AM</td>
                <td id="M1000"></td>
                <td id="T1000"></td>
                <td id="W1000"></td>
                <td id="Th1000"></td>
                <td id="F1000"></td>
                <td id="S1000"></td>
                <td id="Su1000"></td>
            </tr>
            <tr>
                <td class="tableTime">11:00-12:00PM</td>
                <td id="M1100"></td>
                <td id="T1100"></td>
                <td id="W1100"></td>
                <td id="Th1100"></td>
                <td id="F1100"></td>
                <td id="S1100"></td>
                <td id="Su1100"></td>
            </tr>
            <tr>
                <td class="tableTime">1:00-2:00PM</td>
                <td id="M1200"></td>
                <td id="T1200"></td>
                <td id="W1200"></td>
                <td id="Th1200"></td>
                <td id="F1200"></td>
                <td id="S1200"></td>
                <td id="Su1200"></td>
            </tr>
            <tr>
                <td class="tableTime">2:00-3:00PM</td>
                <td id="M1300"></td>
                <td id="T1300"></td>
                <td id="W1300"></td>
                <td id="Th1300"></td>
                <td id="F1300"></td>
                <td id="S1300"></td>
                <td id="Su1300"></td>
            </tr>
            <tr>
                <td class="tableTime">3:00-4:00PM</td>
                <td id="M1400"></td>
                <td id="T1400"></td>
                <td id="W1400"></td>
                <td id="Th1400"></td>
                <td id="F1400"></td>
                <td id="S1400"></td>
                <td id="Su1400"></td>
            </tr>
            <tr>
                <td class="tableTime">4:00-5:00PM</td>
                <td id="M1500"></td>
                <td id="T1500"></td>
                <td id="W1500"></td>
                <td id="Th1500"></td>
                <td id="F1500"></td>
                <td id="S1500"></td>
                <td id="Su1500"></td>
            </tr>
            <tr>
                <td class="tableTime">5:00-6:00PM</td>
                <td id="M1600"></td>
                <td id="T1600"></td>
                <td id="W1600"></td>
                <td id="Th1600"></td>
                <td id="F1600"></td>
                <td id="S1600"></td>
                <td id="Su1600"></td>
            </tr>
        </table>

        <br>

        <div class="d-flex justify-content-end">

            <a href="postDetails.html">
                <button type="button" class="btn btn-lg btn-primary pull-right">Back </button>
            </a>
            &nbsp; &nbsp; &nbsp;        
            <button id="postButton" type="button" class="btn btn-lg btn-primary pull-right"> Post </button>
            
        </div>



        <br>


        <footer class="navbar justify-content-evenly fixed-bottom">
            <a href="main.html">
                <i class="material-icons">home</i>
            </a>
            <i class="material-icons">info</i>
            <a href="missionBoard.html">
                <i class="material-icons"><span class="material-icons-two-tone"> volunteer_activism </span> </i>
            </a>
            <a href="profile.html">
                <i class="material-icons">account_circle</i>
            </a>
        </footer>



    </div>



    <!--------------------------------------------------->
    <!-- Your Javascript Libraries and scripts go here -->
    <!--------------------------------------------------->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script>

        //listen for mouse clicks on the table
        $(function () {
            var isMouseDown = false,
                isHighlighted;
            $("#our_table td")
                .mousedown(function () {
                    isMouseDown = true;
                    $(this).toggleClass("highlighted");
                    isHighlighted = $(this).hasClass("highlighted");

                    return false; // prevent text selection
                })
                .mouseover(function () {
                    if (isMouseDown) {
                        $(this).toggleClass("highlighted", isHighlighted);
                    }
                });

            $(document)
                .mouseup(function () {
                    isMouseDown = false;
                });
        });

        //add ids of toggled time slots into an array to store information of user's availability
        function saveToggles(postid, toggles) {
            //get all the toggled divs into an array
            //var toggles = ["M800", "M900", "M1000", "W800", "W900", "W1000", "F800", "F900", "F1000"];;   //get from input param

            toggles.forEach(item => { // provided by addPostListener
                console.log(item);
                db.collection("posts").doc(postid).set({ // go to postid document in post collection and update the availabilities key value pair (array)
                    availability: firebase.firestore.FieldValue.arrayUnion(item)    // add item (from toggles list in 318) to array
                }, { merge: true });
            }) 
        }


        // function is always running
        function addPostListener() {
            document.getElementById("postButton").addEventListener("click", function () {


                //var postid = "G4z0EXLAg0XaI93l5CiU";     //should get this from the URL param (?)
                // create a URL object
                let params = new URL(window.location.href); // grabs URL that got us here in the first place
                let postid = params.searchParams.get("postid"); //parse "postid"

                //get all the divs where class is "highligted"
                //it should return a list of elements
                var highlighted = document.getElementsByClassName("highlighted");
                var list = [];
                console.log(highlighted);

                //loop thru these dom elements
                for (x of highlighted) {
                    //if the id is not empty string, add it to our list
                    if (x.id != "")
                        list.push(x.id);  //the id's use slot names
                }

                //pass the list of slots to be saved
                //pass in the postid as well, so we know which doc to save it in
                console.log(list);    //list of slot names 
                saveToggles(postid, list);   //pass list of toggles
            })
        }
        addPostListener();

    </script>

</body>

</html>